<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login & Registrasi - Toko AEJ</title>
    
    <script src="https://unpkg.com/feather-icons"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,300;0,400;0,700;1,700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="CSS/style.css" />
    <style>
      body { display: flex; justify-content: center; align-items: center; height: 100vh; background-color: #010101; }
      .form-container { background-color: #1a1a1a; padding: 2rem 3rem; border-radius: 1rem; border: 1px solid #b6895b; width: 90%; max-width: 400px; box-shadow: 0 0 20px rgba(182, 137, 91, 0.2); }
      .form-container h2 { color: #fff; text-align: center; margin-bottom: 2rem; font-size: 2.5rem; }
      .form-container h2 span { color: #b6895b; }
      .form-container .input-group { position: relative; margin: 1.5rem 0; }
      .form-container .input-group input { width: 100%; padding: 1rem; font-size: 1rem; color: #fff; background-color: #333; border: 1px solid #555; border-radius: 0.5rem; }
      .form-container .btn { width: 100%; margin-top: 1.5rem; }
      .message { color: #e74c3c; text-align: center; margin-top: 1rem; display: none; }
      .message.success { color: #2ecc71; }
      .toggle-link { color: #aaa; text-align: center; margin-top: 2rem; font-size: 0.9rem; }
      .toggle-link a { color: #b6895b; font-weight: 700; text-decoration: none; }
      .toggle-password { position: absolute; top: 50%; right: 1rem; transform: translateY(-50%); cursor: pointer; color: #aaa; }
    </style>
</head>
<body>
    <div class="form-container">
        <div id="login-section">
            <h2>Login <span>AEJ</span></h2>
            <form id="login-form">
                <div class="input-group">
                    <input type="text" id="login-username" placeholder="Username" required />
                </div>
                <div class="input-group">
                    <input type="password" id="login-password" placeholder="Password" required />
                    <i class="toggle-password" data-feather="eye"></i>
                </div>
                <button type="submit" class="btn">Login</button>
                <p id="login-message" class="message"></p>
            </form>
            <p class="toggle-link">Belum punya akun? <a href="#" id="show-register">Registrasi</a></p>
        </div>

        <div id="register-section" style="display: none;">
            <h2>Registrasi <span>AEJ</span></h2>
            <form id="register-form">
                <div class="input-group">
                    <input type="text" id="register-username" placeholder="Username Baru" required />
                </div>
                <div class="input-group">
                    <input type="email" id="register-email" placeholder="Email" required />
                </div>
                <div class="input-group">
                    <input type="password" id="register-password" placeholder="Password (min. 6 karakter)" required />
                    <i class="toggle-password" data-feather="eye"></i>
                </div>
                 <div class="input-group">
                    <input type="password" id="confirm-password" placeholder="Konfirmasi Password" required />
                    <i class="toggle-password" data-feather="eye"></i>
                </div>
                <button type="submit" class="btn">Registrasi</button>
                <p id="register-message" class="message"></p>
            </form>
            <p class="toggle-link">Sudah punya akun? <a href="#" id="show-login">Login</a></p>
        </div>
    </div>

    <script>
      feather.replace();

      const loginSection = document.getElementById('login-section');
      const registerSection = document.getElementById('register-section');
      const showRegisterLink = document.getElementById('show-register');
      const showLoginLink = document.getElementById('show-login');
      const loginForm = document.getElementById('login-form');
      const registerForm = document.getElementById('register-form');
      const loginMessage = document.getElementById('login-message');
      const registerMessage = document.getElementById('register-message');
      
      function showMessage(element, text, isSuccess = false) {
          element.textContent = text;
          element.className = 'message';
          if (isSuccess) {
              element.classList.add('success');
          }
          element.style.display = 'block';
      }
      
      showRegisterLink.addEventListener('click', (e) => {
          e.preventDefault();
          loginSection.style.display = 'none';
          registerSection.style.display = 'block';
      });
      
      showLoginLink.addEventListener('click', (e) => {
          e.preventDefault();
          registerSection.style.display = 'none';
          loginSection.style.display = 'block';
      });

      loginForm.addEventListener('submit', async function(e) {
          e.preventDefault();
          loginMessage.style.display = 'none';
          const username = document.getElementById('login-username').value;
          const password = document.getElementById('login-password').value;

          const response = await fetch('php/LoginProcess.php', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ username, password })
          });
          const result = await response.json();
          
          if (result.status === 'success') {
              switch (result.role) {
                  case 'admin': window.location.href = 'AdminDashboard.php'; break;
                  case 'kasir': window.location.href = 'KasirDashboard.php'; break;
                  case 'gudang': window.location.href = 'GudangDashboard.php'; break;
                  default: window.location.href = 'HalamanAwal.php'; break;
              }
          } else {
              showMessage(loginMessage, result.message);
          }
      });
      
      registerForm.addEventListener('submit', async function(e) {
          e.preventDefault();
          registerMessage.style.display = 'none';
          const username = document.getElementById('register-username').value;
          const email = document.getElementById('register-email').value;
          const password = document.getElementById('register-password').value;
          const confirmPassword = document.getElementById('confirm-password').value;

          if (password !== confirmPassword) {
              showMessage(registerMessage, 'Password dan konfirmasi password tidak cocok.');
              return;
          }

          const response = await fetch('php/RegisterProcess.php', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ username, email, password }) 
          });
          const result = await response.json();
          if (result.status === 'success') {
              showMessage(registerMessage, result.message, true);
              registerForm.reset();
              setTimeout(() => {
                 showLoginLink.click();
                 showMessage(loginMessage, 'Registrasi berhasil, silakan login.', true);
              }, 2000);
          } else {
              showMessage(registerMessage, result.message);
          }
      });

      const formContainer = document.querySelector('.form-container');
      
      formContainer.addEventListener('click', function(e) {
          const icon = e.target.closest('.toggle-password');
          if (!icon) {
              return;
          }

          const inputGroup = icon.parentElement;
          const passwordField = inputGroup.querySelector('input');

          if (passwordField) {
              const type = passwordField.getAttribute('type') === 'password' ? 'text' : 'password';
              passwordField.setAttribute('type', type);
              icon.setAttribute('data-feather', type === 'password' ? 'eye' : 'eye-off');
              feather.replace();
          }
      });
    </script>
</body>
</html>